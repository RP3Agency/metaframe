function metaframe_embed_comments(){var a=$('meta[name="metaframe-csv"]').attr("content"),b=$('meta[name="metaframe-form"]').attr("content");if(void 0!==b||void 0!==a){void 0===a&&(a="comments.csv"),console.log(a),console.log(b);var c=["<h2>Viewer Comments</h2>",'<form method="post" id="metaframe-form" class="mf-comment-form">','<div id="metaframe-form-error"></div>','<input id="metaframe-user" type="text" placeholder="Your name goes here." />','<textarea id="metaframe-comment" placeholder="Your comment goes here."></textarea>','<input type="submit" value="Comment" />',"</form>",'<div class="mf-comments"></div>'];$(".notes").append(c.join("\n"));var d=metaframe_retrieve_comments({csv_filename:a,form_action:b});$(".mf-comment-form").on("submit",metaframe_submit({comments_reloader:d,form_action:b})),d(),setInterval(d,6e5)}}function metaframe_submit(a){var b=a;return function(a){a.preventDefault();var c={},d=!1,e=$("#metaframe-form"),f=$("#metaframe-user"),g=$("#metaframe-comment");return c.user=f.val(),c.comment=g.val(),""===c.user||""===c.comment?(d="Please fill in all fields.",e.addClass("error")):e.removeClass("error"),d?($("#metaframe-form-error").html(d),void 0):($("#metaframe-comment").val(""),c.timestamp=Date.now(),$.ajax({url:b.form_action,type:"POST",data:c}).done(function(){b.comments_reloader()}),void 0)}}function metaframe_retrieve_comments(a){function b(){var a=c();$(".mf-comments").html($(a).html())}function c(a){a=a||0;var b=document.createElement("div"),e=/^"|"?/g;if(void 0===d[a])return b;var f=d[a].split('","');if(f.length<=1)return b;for(var g=[],h=0;h<f.length;h++)g.push("<span>"),g.push(f[h].replace(e,"")),g.push("</span>");b.innerHTML=g.join("\n");var i=c(a+1);return i.appendChild(b),i}var d=[],e=a;return function(){console.log("(re)loading comments"),$.ajax({url:e.csv_filename,contentType:"text/csv"}).done(function(a){var c=a.split("\n");c!==d&&(d=c,b())})}}$(document).ready(function(){function a(){$(".notes-anchor, .notes-tab").click(function(a){a.preventDefault(),$(".notes-tab").hasClass("open")?($(".notes").animate({right:"-330px"},300),$(".notes-tab").animate({right:"10px"},300),$(".notes-tab").removeClass("open")):($(".notes").animate({right:"0px"},300),$(".notes-tab").animate({right:"340px"},300),$(".notes-tab").addClass("open"))})}function b(){$(".notes-anchor, .notes-tab").click(function(a){a.preventDefault(),$(".notes-tab").hasClass("open")?($(".notes").animate({bottom:"-330px"},300),$(".notes-tab").animate({bottom:"10px"},300),$(".notes-tab").removeClass("open")):($(".notes").animate({bottom:"0px"},300),$(".notes-tab").animate({bottom:"340px"},300),$(".notes-tab").addClass("open"))})}$("<a/>",{"class":"notes-tab",href:"#"}).appendTo("body"),$("<div/>",{"class":"notes Scrollable"}).appendTo("body");var c=$(this).attr("title");$(".notes").html("<h1>"+c+"</h1>");var d=['<form><input type="checkbox" id="noteBox" checked="checked" >show note markers</form>',"<h2>Page Notes</h2>"];$(d.join("")).appendTo(".notes");for(var e=0,f=$(".notation").map(function(){return e++,$(this).attr("note")}),g=0;e-0>g;g++)$(".notes").append('<div class="note-holder"><span class="note-count">'+(g+1)+'</span><span class="note-body">'+f[g]+"</span></div");var h=0;$(".notation").each(function(){h++,$(this).prepend('<span class="notes-anchor"><figure>'+h+"</figure></span>")}),metaframe_embed_comments(),$(window).on("resize",function(){$(".notes-tab").removeClass("open"),$(".notes-anchor, .notes-tab").unbind("click"),$(window).width()>700?($(".notes").css({right:"-330px"}),$(".notes-tab").css({right:"10px"}),$(".notes").removeClass("bottom"),a()):($(".notes").css({bottom:"-330px"}),$(".notes-tab").css({bottom:"10px"}),$(".notes").addClass("bottom"),b())}),$(window).width()>700?a():($(".notes").addClass("bottom"),b()),$("#noteBox").click(function(){$(".notes-anchor").toggle()}),0===$(".note-body").size()&&$(".notes").append("<p>There are no notes yet. I guess you can go home early today!</p>"),$(".Scrollable").on("DOMMouseScroll mousewheel",function(a){var b=$(this),c=this.scrollTop,d=this.scrollHeight,e=b.height(),f=a.originalEvent.wheelDelta,g=f>0,h=function(){return a.stopPropagation(),a.preventDefault(),a.returnValue=!1,!1};return!g&&-f>d-e-c?(b.scrollTop(d),h()):g&&f>c?(b.scrollTop(0),h()):void 0})});